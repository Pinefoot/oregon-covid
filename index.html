<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Oregon COVID-19 Reports</title>
  <link rel="stylesheet" href="tufte.css" />
  <link rel="stylesheet" href="index.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="./lib/charts.js"></script>
  <script src="./lib/tables.js"></script>

</head>

<body>
  <article>
    <h1>Oregon COVID-19 Reports</h1>

    <section>
      <h2>Overview</h2>

      <p>
        This page presents the COVID-19 data<label for="oha-covid-reports" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="oha-covid-reports" class="margin-toggle" />
        <span class="sidenote">
          See Oregon Health Authority's <a href="https://govstatus.egov.com/OR-OHA-COVID-19">COVID-19 Reports</a>
        </span>
        made public by the Oregon Health Authority. It is updated daily as the OHA makes
        new data available.
      </p>

      <p>
        The OHA's <a href="https://www.oregon.gov/oha/erd/pages/covid-19-news.aspx">External Relations Division</a>, has news releases with valuable context about the data you see here.
      </p>
    </section>

    <section>
      <section>
        <h2>Care Capacity</h2>
        <h3>Hospitalizations</h3>
        <p>
          While the daily COVID-19 case counts make headlines, the most important<label for="most-important-data" class="margin-toggle sidenote-number"></label>
          <input type="checkbox" id="most-important-data" class="margin-toggle" />
          <span class="sidenote">
            <a href="https://www.youtube.com/watch?v=sxeKZg9NqN4&feature=youtu.be">Why the number of cases is increasing</a>, Oregon Public Health Division.
          </span> data to focus on during the pandemic is the state's capacity to care for Oregonians in need of medical attention, and the load the medical system is currently under.
        </p>
        <p>
          Of those diagnosed with COVID-19, <strong id="hospitalized-covid-latest" class="numeral">—</strong> patients have been hospitalized, <strong
            id="not-hospitalized-covid-latest" class="numeral">—</strong> were not hospitalized, and the status of <strong id="not-reported-covid-latest" class="numeral">—</strong> were not reported.
        </p>

        <figure>
          <figcaption>COVID-19 hospitalizations over time</figcaption>
          <svg class="cases-chart" id="hospitalization-chart"></svg>
          <div class="legend"><div class="legend-icon not-hospitalized">&nbsp;</div> — Patients not hospitalized</div>
          <div class="legend"><div class="legend-icon hospitalized">&nbsp;</div> — Patients hospitalized</div>
          <div class="legend"><div class="legend-icon not-reported">&nbsp;</div> — Patients for which no status was reported</div>
        </figure>
      </section>

      <h3>Ventilator Supply</h3>
      <p>
        There are currently <strong id="patients-on-ventilators" class="numeral">—</strong> COVID-19 patients on ventilators. The state has <strong id="ventilators-available-latest" class="numeral">—</strong> ventilators available.
      </p>

      <figure>
        <figcaption>Ventilator supply over time</figcaption>
        <svg class="cases-chart" id="ventilator-chart"></svg>
        <div class="legend"><div class="legend-icon available-ventilators">&nbsp;</div> — Available ventilators</div>
        <div class="legend"><div class="legend-icon patients-on-ventilators">&nbsp;</div> — COVID-19 patients on ventilators</div>
      </figure>

      <h3>Hospital Bed Capacity</h3>
      <p>
        For <strong>adults</strong>, Oregon has <strong id="adult-bed-icu-latest" class="numeral">—</strong> ICU beds available and <strong id="adult-bed-non-icu-latest" class="numeral">—</strong>
        non-ICU beds.
      </p>

      <figure>
        <figcaption>Adult hospital beds over time</figcaption>
        <svg class="cases-chart" id="adult-bed-chart"></svg>
        <div class="legend"><div class="legend-icon available-non-icu-beds">&nbsp;</div> — Available adult non-ICU Beds</div>
        <div class="legend"><div class="legend-icon available-icu-beds">&nbsp;</div> — Available adult ICU Beds</div>
      </figure>

      <p>
        For <strong>children</strong>, Oregon has <strong id="pediatric-bed-icu-latest" class="numeral">—</strong> ICU beds available and <strong id="pediatric-bed-non-icu-latest" class="numeral">—</strong>
        non-ICU beds.
      </p>

      <figure>
        <figcaption>Pediatric hospital beds over time</figcaption>
        <svg class="cases-chart" id="pediatric-bed-chart"></svg>
        <div class="legend"><div class="legend-icon available-non-icu-beds">&nbsp;</div> — Available pediatric non-ICU Beds</div>
        <div class="legend"><div class="legend-icon available-icu-beds">&nbsp;</div> — Available pediatric ICU Beds</div>
      </figure>
    </section>

    <section>
      <h2>Cases</h2>

      <p>
        COVID-19 test results provide a window into how the virus is spreading in Oregon, but the state's limited ability to test means the data does not paint an accurate picture of the total number of COVID-19 cases in the state. A report by the Institute for Disease Modeling on <strong>March 23rd</strong> estimated the number of COVID-19 cases in Oregon was four times higher<label for="higher-than-diagnosed" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="higher-than-diagnosed" class="margin-toggle" />
        <span class="sidenote">
          <a href="https://govsite-assets.s3.amazonaws.com/VooxlwVoTey3aArqqFkG_Oregon-COVID-19-Projections-2020-03-23.pdf">Working paper: Projected COVID-19 epidemic trends
            and health system needs for Oregon</a>, Institute for Disease Modeling.
        </span> than the number currently diagnosed.
      </p>

      <p>
        A shipment of 4,000 testing swabs from the U.S. Department of Health and Human Services on <strong>March 25th</strong> increased Oregon's testing capacity<label for="swab-shipment" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="swab-shipment" class="margin-toggle" />
        <span class="sidenote">
          <a href="https://www.opb.org/news/article/covid-19-coronavirus-test-capacity-oregon-swab-shortage/">Surge In Oregon's COVID-19 Testing Capacity Expected This Week</a>, Oregon Public Broadcasting.
        </span>. A spike in positive and negative COVID-19 cases may occur due
        to increased testing in the weeks that follow<label for="why-num-cases-increasing" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="why-num-cases-increasing" class="margin-toggle" />
        <span class="sidenote">
          <a href="https://www.youtube.com/watch?v=sxeKZg9NqN4&feature=youtu.be">Why the number of cases is increasing</a>, Oregon Public Health Division.
        </span>, it does not imply a sudden increase in the rate of COVID-19 transmission.
      </p>

      <h3>Positive</h3>

      <p>
        There have been <strong id="positive-delta" class="numeral">—</strong> newly confirmed cases of COVID-19 since the last report, and there have been <strong id="positive-total" class="numeral">—</strong> cases in Oregon overall.
      </p>

      <figure>
        <figcaption>Positive COVID-19 cases over time</figcaption>
        <svg class="cases-chart" id="positive-cases-chart"></svg>
        <div class="legend"><div class="legend-icon positive-test">&nbsp;</div> — Positive COVID-19 tests (cumulative)</div>
      </figure>

      <h3>Negative</h3>

      <p>
        There have been <strong id="negative-delta" class="numeral">—</strong> new negative tests of COVID-19 since the last report, and there have been <strong id="negative-total" class="numeral">—</strong> negative tests in Oregon overall.
      </p>

      <figure>
        <figcaption>Negative COVID-19 cases over time</figcaption>
        <svg class="cases-chart" id="negative-cases-chart"></svg>
        <div class="legend"><div class="legend-icon negative-test">&nbsp;</div> — Negative COVID-19 tests (cumulative)</div>
      </figure>

      <h3>Deaths</h3>

      <p>
        There have been <strong id="death-delta" class="numeral">—</strong> COVID-19-related deaths since the last report, and there have been <strong id="death-total" class="numeral">—</strong> COVID-19-related deaths in Oregon overall.
      </p>

      <figure>
        <figcaption>COVID-19 deaths over time.</figcaption>
        <svg class="cases-chart" id="deaths-chart"></svg>
        <div class="legend"><div class="legend-icon death">&nbsp;</div> — COVID-19-related deaths (cumulative)</div>
      </figure>

      <h3>All OHA COVID-19 Case Reports, by Day</h3>

      <p>
        This cases table is pulled from the OHA's daily COVID updates<label for="data-daily-covid" class="margin-toggle sidenote-number"></label>
        <input type="checkbox" id="data-daily-covid" class="margin-toggle" />
        <span class="sidenote">
          See Oregon Health Authority's <a href="https://govstatus.egov.com/OR-OHA-COVID-19">COVID-19 Reports</a>
        </span>. It's currently updated daily by hand. You can find CSV files of the data for test results and deaths <a href="./reports.csv">here</a>, and hospital capacity data <a href="./hospitals.csv">here</a>.
      </p>

      <table class="cases-table" id="covid-cases-table">
        <thead>
          <tr class="cases-column-groupings">
            <th></th>
            <th colspan=3>Positive Tests</th>
            <th colspan=3>Negative Tests</th>
            <th colspan=3>Deaths</th>
          </tr>
          <tr class="cases-data-columns">
            <th>Date</th>
            <th class="spacer">
            <th>New</th>
            <th>Total</th>
            <th class="spacer">
            <th>New</th>
            <th>Total</th>
            <th class="spacer">
            <th>New</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>
  </article>
  <footer class="page-footer">
    <a href="mailto:mbaker.pdx@gmail.com">email</a> • <a href="https://github.com/mattbaker/oregon-covid">github</a>
  </footer>
</body>

<script>
  Promise.all([
    d3.csv("reports.csv",  d3.autoType),
    d3.csv("hospitals.csv",  d3.autoType),
  ]).then(function(files) {
    let reports = files[0];
    let hospitalInfo = files[1];

    // Hospitalization
    renderInlineLatest("#hospitalized-covid-latest", hospitalInfo, "hospitalized")
    renderInlineLatest("#not-hospitalized-covid-latest", hospitalInfo, "not_hospitalized")
    renderInlineLatest("#not-reported-covid-latest", hospitalInfo, "status_not_provided")
    renderStackedChart({
      chartSelector: "#hospitalization-chart",
      data: hospitalInfo,
      attributes: ["status_not_provided", "hospitalized", "not_hospitalized"],
      colors: {
        "hospitalized": {area: "rgba(255, 0, 0, 0.3)", line: "rgba(255, 0, 0, 1.0)"},
        "not_hospitalized": {area: "rgba(255, 209, 18, 0.35)", line: "rgba(255, 212, 0, 1.0)"},
        "status_not_provided": {area: "rgba(0, 0, 0, 0.1)", line: "rgba(0, 0, 0, 0.40)"}
      }
    })

    // Ventilators
    renderInlineLatest("#ventilators-available-latest", hospitalInfo, "available_ventilators")
    renderInlineLatest("#patients-on-ventilators", hospitalInfo, "covid_on_ventilators")
    renderOpposingChart({
      chartSelector: "#ventilator-chart",
      data: hospitalInfo,
      positiveAttributes: ["available_ventilators"],
      negativeAttributes: ["covid_on_ventilators"],
      colors: {
        "covid_on_ventilators": {area: "rgba(255, 0, 0, 0.3)", line: "rgba(255, 0, 0, 1.0)"},
        "available_ventilators": {area: "rgba(0, 120, 255, 0.3)", line: "rgba(0, 120, 255, 1.0)"},
      }
    })

    // Adult Beds
    renderInlineLatest("#adult-bed-icu-latest", hospitalInfo, "available_adult_icu_beds")
    renderInlineLatest("#adult-bed-non-icu-latest", hospitalInfo, "available_adult_beds")
    renderStackedChart({
      chartSelector: "#adult-bed-chart",
      data: hospitalInfo,
      attributes: ["available_adult_icu_beds", "available_adult_beds"],
      colors: {
        "available_adult_icu_beds": {area: "rgba(135, 110, 255, 0.3)", line: "rgba(135, 110, 255, 1.0)"},
        "available_adult_beds": {area: "rgba(255, 164, 250, 0.3)", line: "rgba(255, 164, 250, 1.0)"},
      }
    })

    // Pediatric Beds
    renderInlineLatest("#pediatric-bed-icu-latest", hospitalInfo, "available_pediatric_icu")
    renderInlineLatest("#pediatric-bed-non-icu-latest", hospitalInfo, "available_pediatric")
    renderStackedChart({
      chartSelector: "#pediatric-bed-chart",
      data: hospitalInfo,
      attributes: ["available_pediatric_icu", "available_pediatric"],
      colors: {
        "available_pediatric_icu": {area: "rgba(135, 110, 255, 0.3)", line: "rgba(135, 110, 255, 1.0)"},
        "available_pediatric": {area: "rgba(255, 164, 250, 0.3)", line: "rgba(255, 164, 250, 1.0)"},
      }
    })

    // Positive cases
    renderInlineLatest("#positive-total", reports, "positive")
    renderInlineDelta("#positive-delta", reports, "positive")
    renderStackedChart({
      chartSelector: "#positive-cases-chart",
      data: reports,
      attributes: ["positive"],
      colors: {
        "positive": {area: "rgba(255, 0, 0, 0.3)", line: "rgba(255, 0, 0, 1.0)"},
      }
    })

    // Negative cases
    renderInlineLatest("#negative-total", reports, "negative")
    renderInlineDelta("#negative-delta", reports, "negative")
    renderStackedChart({
      chartSelector: "#negative-cases-chart",
      data: reports,
      attributes: ["negative"],
      colors: {
        "negative": {area: "rgba(107, 167, 83, 0.3)", line: "rgba(107, 167, 83, 1.0)"},
      }
    })

    // Deaths
    renderInlineLatest("#death-total", reports, "deaths")
    renderInlineDelta("#death-delta", reports, "deaths")
    renderStackedChart({
      chartSelector: "#deaths-chart",
      data: reports,
      attributes: ["deaths"],
      colors: {
        "deaths": {area: "rgba(65, 65, 65, 0.3)", line: "rgba(65, 65, 65, 1.0)"},
      }
    })

    // Case table
    renderCasesTable("#covid-cases-table", reports)
  })
  .catch(function(err) {
      throw err;
  });
</script>

</html>
